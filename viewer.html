<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viewer (Slideshow)</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <div class="card">
        <div class="card-header"><span class="title-text">./view_slideshow_live.sh</span></div>
        <div class="card-body">
            <h2 id="status">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...</h2>
            <!-- –≠—Ç–æ —Å–Ω–æ–≤–∞ <img> –¥–ª—è –ø–æ–∫–∞–∑–∞ –∫–∞—Ä—Ç–∏–Ω–æ–∫ -->
            <img id="remoteImage" style="width: 100%; background-color: #000; border-radius: 8px; min-height: 200px;">
        </div>
    </div>
</div>
<script>
    const statusEl = document.getElementById('status');
    const image = document.getElementById('remoteImage');
    const SERVER_URL = 'wss://9d2488b5-3986-4269-bfdd-d01f421e0f4c-00-asck2nhxkvc6.pike.replit.dev/';
    
    function connect() {
        const ws = new WebSocket(SERVER_URL, 'viewer');
        ws.binaryType = 'blob'; // –í–∞–∂–Ω–æ –¥–ª—è –ø—Ä–∏–µ–º–∞ –¥–≤–æ–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

        ws.onopen = () => {
            statusEl.textContent = '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏...';
        };

        ws.onmessage = event => {
            statusEl.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å, –∫–æ–≥–¥–∞ –ø–æ—à–ª–æ –≤–∏–¥–µ–æ
            
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π URL –¥–ª—è Blob –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É
            // –≠—Ç–æ —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const oldUrl = image.src;
            image.src = URL.createObjectURL(event.data);
            
            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–π URL –∏–∑ –ø–∞–º—è—Ç–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–µ–∫
            if (oldUrl.startsWith('blob:')) {
                URL.revokeObjectURL(oldUrl);
            }
        };

        ws.onclose = () => {
            statusEl.style.display = 'block';
            statusEl.textContent = 'üî¥ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ. –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3—Å...';
            setTimeout(connect, 3000);
        };
    }
    
    connect();
</script>
</body>
</html>
