<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viewer (True Broadcast)</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <div class="card">
        <div class="card-header">
            <span class="title-text">./view_live.sh</span>
        </div>
        <div class="card-body">
            <h2 id="status">–û–∂–∏–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏...</h2>
            <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º img, —Ç–∞–∫ –∫–∞–∫ –ø–æ–ª—É—á–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫–∏ (JPEG) -->
            <img id="streamImage" style="width: 100%; background-color: #000; border-radius: 8px;">
        </div>
    </div>
</div>

<script>
    const statusEl = document.getElementById('status');
    const image = document.getElementById('streamImage');

    // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –Ω–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –∑—Ä–∏—Ç–µ–ª—å
    const ws = new WebSocket('ws://–ê–î–†–ï–°_–í–ê–®–ï–ì–û_–ö–û–ú–ü–¨–Æ–¢–ï–†–ê:8080');

    ws.onopen = () => {
        statusEl.textContent = "–ü–æ–¥–∫–ª—é—á–µ–Ω–æ. –û–∂–∏–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ...";
    };

    ws.onmessage = event => {
        if (event.data === 'stream_ended') {
            statusEl.textContent = "–¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞.";
            image.src = ''; // –û—á–∏—â–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É
            return;
        }
        
        // –ö–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ (–∫–∞–¥—Ä), –º—ã –ø—Ä–æ—Å—Ç–æ —Å—Ç–∞–≤–∏–º –µ–≥–æ –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è img
        statusEl.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å, –∫–æ–≥–¥–∞ –ø–æ—à–ª–æ –≤–∏–¥–µ–æ
        image.src = event.data;
    };
    
    ws.onclose = () => {
        statusEl.style.display = 'block';
        statusEl.textContent = "üî¥ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º –ø–æ—Ç–µ—Ä—è–Ω–æ.";
    };
</script>
</body>
</html>
